<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <!-- Viewport ayarÄ±: Zoom engellendi, tam ekran, gÃ¼venli alan desteÄŸi -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bilal CÃ¼mle Tamamlama Mobil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');

        /* TEMEL AYARLAR */
        body, html {
            height: 100%;
            width: 100%;
            overflow: hidden; /* KaydÄ±rmayÄ± engelle */
            background-color: #0f172a;
            font-family: 'Fredoka', sans-serif;
            touch-action: none; /* TarayÄ±cÄ± dokunma efektlerini kapat */
            user-select: none; /* Metin seÃ§imini kapat */
            -webkit-user-select: none;
            overscroll-behavior: none; /* Lastik efektini kapat */
        }

        /* OYUN ALANI */
        #game-wrapper {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            padding-top: env(safe-area-inset-top); /* Ã‡entik boÅŸluÄŸu */
            padding-bottom: env(safe-area-inset-bottom); /* Home bar boÅŸluÄŸu */
        }

        #game-area {
            position: relative;
            flex-grow: 1; /* Kalan tÃ¼m alanÄ± kapla */
            width: 100%;
            background: linear-gradient(to bottom, #1e293b, #0f172a);
            overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
        }

        /* --- HIZ AYARI (MOBÄ°L DOSTU) --- */
        .speed-control {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 50;
            background: rgba(15, 23, 42, 0.9);
            padding: 8px 12px;
            border-radius: 99px;
            border: 1px solid #334155;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        /* Slider baÅŸlÄ±ÄŸÄ±nÄ± bÃ¼yÃ¼t (Dokunmak kolay olsun) */
        input[type=range] {
            width: 100px;
            accent-color: #fbbf24;
            height: 20px;
        }

        /* --- CÃœMLE HEDEF ALANI --- */
        #target-zone {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            z-index: 15;
            transition: all 0.5s ease;
        }

        /* Yatay Mod */
        .zone-horizontal {
            bottom: 20px; /* Kontrollerin hemen Ã¼stÃ¼ deÄŸil, biraz yukarÄ± */
            left: 0;
            width: 100%;
            min-height: 80px;
            flex-direction: row;
            padding: 0 10px;
        }

        /* Dikey Mod */
        .zone-vertical {
            right: 10px;
            top: 15%;
            height: 70%;
            width: 60px;
            flex-direction: column;
            border-left: 2px dashed rgba(255,255,255,0.1);
            justify-content: center;
        }

        .sentence-part {
            font-size: clamp(1rem, 4vw, 1.5rem); /* Ekrana gÃ¶re fontu ayarla */
            font-weight: bold;
            color: #94a3b8;
            margin: 5px;
            white-space: nowrap;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        .zone-vertical .sentence-part {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transform: rotate(180deg);
            margin: 10px 0;
        }

        .drop-zone {
            /* Responsive boyutlar */
            min-width: 25vw; /* EkranÄ±n Ã§eyreÄŸi */
            max-width: 150px;
            height: 50px;
            border: 3px dashed #fbbf24;
            background-color: rgba(251, 191, 36, 0.15);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.4);
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
        }

        .zone-vertical .drop-zone {
            min-width: 50px;
            min-height: 20vh; /* Ekran yÃ¼ksekliÄŸine gÃ¶re */
            max-height: 150px;
            writing-mode: vertical-rl;
            transform: rotate(180deg);
        }

        /* --- DÃœÅžEN KELÄ°MELER --- */
        .falling-word {
            position: absolute;
            padding: 10px 16px; /* Daha geniÅŸ dokunma/gÃ¶rÃ¼ÅŸ alanÄ± */
            border-radius: 12px;
            font-weight: bold;
            text-align: center;
            white-space: nowrap;
            font-size: clamp(0.9rem, 3.5vw, 1.2rem);
            z-index: 10;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            background: #6366f1; 
            color: white;
            border: 2px solid #818cf8;
            transition: transform 0.2s;
        }

        .rotated-vertical {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transform: rotate(180deg);
            padding: 16px 10px;
        }

        /* --- KONTROLLER (ALT BAR) --- */
        .controls {
            height: 100px; /* Sabit yÃ¼kseklik */
            width: 100%;
            background: #0f172a;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 10px;
            border-top: 2px solid #334155;
            z-index: 30;
            flex-shrink: 0; /* KÃ¼Ã§Ã¼lme */
        }

        .control-btn {
            background: rgba(255,255,255,0.08);
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            /* Dokunma efektleri */
            touch-action: manipulation;
        }
        
        .control-btn:active {
            background: rgba(99, 102, 241, 0.4);
            transform: scale(0.96);
            border-color: #6366f1;
        }

        .rotate-btn {
            background: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
            border-color: rgba(245, 158, 11, 0.3);
        }

        /* Liste ve Overlay */
        #completed-list-container::-webkit-scrollbar { width: 4px; }
        #completed-list-container::-webkit-scrollbar-thumb { background: #475569; }

        /* BaÅŸarÄ± Animasyonu */
        .correct-anim { animation: correctPop 0.8s ease-out forwards; }
        @keyframes correctPop {
            0% { transform: scale(1); background-color: #22c55e; border-color: #22c55e; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); background-color: #22c55e; border-color: #22c55e; }
        }
    </style>
</head>
<body>

<div id="game-wrapper">
    
    <!-- BaÅŸlÄ±k (Ãœst Sol) -->
    <div class="absolute top-4 left-4 z-40 pointer-events-none">
        <h1 class="text-lg md:text-2xl font-bold text-yellow-400 drop-shadow-md">CÃœMLE USTASI</h1>
        <div id="level-display" class="text-xs md:text-sm text-cyan-400 font-bold mt-1">Seviye 1</div>
    </div>

    <!-- HÄ±z AyarÄ± (Ãœst SaÄŸ) -->
    <div class="speed-control">
        <span class="text-xs text-gray-300 font-bold whitespace-nowrap"><i class="fa-solid fa-gauge-high"></i> HIZ</span>
        <input type="range" id="speed-slider" min="1" max="10" value="3" step="1">
    </div>

    <!-- Ana Oyun Sahnesi -->
    <div id="game-area">
        
        <!-- GiriÅŸ / BitiÅŸ EkranÄ± (Overlay) -->
        <div id="overlay" class="absolute inset-0 bg-slate-900/95 z-50 flex flex-col items-center justify-center text-center p-6">
            <div id="overlay-icon" class="text-6xl mb-4 animate-bounce">ðŸ“±</div>
            <h2 id="overlay-title" class="text-2xl font-bold text-white mb-2">HazÄ±r mÄ±sÄ±n Bilal?</h2>
            <p id="overlay-desc" class="text-gray-300 mb-6 text-sm">
                Kelimeler aynÄ± renkte!<br>
                Sen sadece doÄŸru olanÄ± hareket ettirebilirsin.<br>
                DoÄŸru kelimeyi bul ve kutuya taÅŸÄ±!
            </p>
            
            <div id="completed-list-container" class="hidden w-full bg-slate-800 rounded-lg p-3 mb-4 max-h-48 overflow-y-auto text-left border border-slate-700 shadow-inner">
                <ul id="sentences-ul" class="space-y-2 text-xs text-gray-300"></ul>
            </div>

            <button onclick="startGame()" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-4 px-12 rounded-2xl shadow-lg transform transition hover:scale-105 active:scale-95 border-b-4 border-green-800 text-xl">
                BAÅžLA
            </button>
        </div>

        <!-- CÃ¼mle Hedef AlanÄ± -->
        <div id="target-zone" class="zone-horizontal">
            <span id="sent-start" class="sentence-part">Ali topu</span>
            <div id="the-gap" class="drop-zone">___</div>
            <span id="sent-end" class="sentence-part">attÄ±.</span>
        </div>

        <!-- DÃ¼ÅŸen Kelimeler -->
        <div id="words-container"></div>

    </div>

    <!-- Kontroller (En Alt) -->
    <div class="controls">
        <button id="btn-left" class="control-btn"><i class="fa-solid fa-arrow-left"></i></button>
        <button id="btn-rotate" class="control-btn rotate-btn"><i class="fa-solid fa-rotate"></i></button>
        <button id="btn-right" class="control-btn"><i class="fa-solid fa-arrow-right"></i></button>
        <button id="btn-down" class="control-btn bg-slate-700/50"><i class="fa-solid fa-arrow-down"></i></button>
    </div>
</div>

<script>
    // --- OYUN VERÄ°LERÄ° ---
    const levels = [
        { start: "Ali topu", end: "attÄ±.", correct: "HAVAYA", wrongs: ["ELMAYA", "KAPIYA", "MASAYA"], dir: 'h' },
        { start: "Okula", end: "giderim.", correct: "SERVÄ°SLE", wrongs: ["UÃ‡AKLA", "GEMÄ°YLE", "UYUYARAK"], dir: 'v' },
        { start: "SÃ¼t veren", end: "hayvandÄ±r.", correct: "Ä°NEK", wrongs: ["KEDÄ°", "TAVUK", "BALIK"], dir: 'h' },
        { start: "DiÅŸlerimi", end: "fÄ±rÃ§alarÄ±m.", correct: "HER GÃœN", wrongs: ["ASLA", "YILDA", "DÃœN"], dir: 'v' },
        { start: "BalÄ±klar", end: "yÃ¼zer.", correct: "DENÄ°ZDE", wrongs: ["AÄžAÃ‡TA", "EVDE", "SOKAKTA"], dir: 'h' },
        { start: "Limon", end: "bir meyvedir.", correct: "EKÅžÄ°", wrongs: ["TUZLU", "TATLI", "ACI"], dir: 'v' },
        { start: "Trafikte", end: "yanÄ±nca dur.", correct: "KIRMIZI", wrongs: ["YEÅžÄ°L", "SARI", "MAVÄ°"], dir: 'h' },
        { start: "TÃ¼rkiye'nin", end: "Ankara'dÄ±r.", correct: "BAÅžKENTÄ°", wrongs: ["YEMEÄžÄ°", "DENÄ°ZÄ°", "KÃ–YÃœ"], dir: 'h' },
        { start: "GÃ¼neÅŸ", end: "Ä±sÄ±tÄ±r.", correct: "BÄ°ZÄ°", wrongs: ["KARPUZU", "GECEYÄ°", "SUYU"], dir: 'v' },
        { start: "KuÅŸlar", end: "yaparlar.", correct: "YUVA", wrongs: ["EV", "OKUL", "ARABA"], dir: 'h' },
        { start: "Bir yÄ±lda", end: "mevsim var.", correct: "DÃ–RT", wrongs: ["Ä°KÄ°", "YEDÄ°", "ON"], dir: 'v' },
        { start: "Kitap", end: "gÃ¼zeldir.", correct: "OKUMAK", wrongs: ["YEMEK", "KOÅžMAK", "YIRTMAK"], dir: 'h' }
    ];

    // --- DEÄžÄ°ÅžKENLER ---
    let currentLevelIdx = 0;
    let isPlaying = false;
    let animationId;
    let completedSentences = [];
    let activeWords = []; 
    let controlledWordIndex = -1;
    let baseSpeedFactor = 3;

    // DOM
    const wordsContainer = document.getElementById('words-container');
    const targetZone = document.getElementById('target-zone');
    const gapEl = document.getElementById('the-gap');
    const sentStart = document.getElementById('sent-start');
    const sentEnd = document.getElementById('sent-end');
    const levelDisplay = document.getElementById('level-display');
    const overlay = document.getElementById('overlay');
    const sentencesUl = document.getElementById('sentences-ul');
    const speedSlider = document.getElementById('speed-slider');

    // Ses Motoru
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;

        if (type === 'win') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, now);
            osc.frequency.exponentialRampToValueAtTime(1000, now + 0.1);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(); osc.stop(now + 0.3);
        } else if (type === 'rotate') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(300, now);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.1);
            osc.start(); osc.stop(now + 0.1);
        } else if (type === 'fail') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.linearRampToValueAtTime(100, now + 0.2);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.2);
            osc.start(); osc.stop(now + 0.2);
        }
    }

    // HÄ±z AyarÄ±
    speedSlider.addEventListener('input', (e) => {
        baseSpeedFactor = parseInt(e.target.value);
        updateActiveSpeeds();
    });

    function updateActiveSpeeds() {
        activeWords.forEach(w => {
            let base = 0.05 * baseSpeedFactor;
            if (w.isControlled) base = (0.05 * baseSpeedFactor) + 0.05; 
            w.speed = base + (Math.random() * 0.05);
        });
    }

    // --- OYUN MOTORU ---

    function loadLevel() {
        const level = levels[currentLevelIdx];
        
        wordsContainer.innerHTML = '';
        activeWords = [];
        gapEl.innerText = "___";
        gapEl.className = "drop-zone"; 
        
        // CÃ¼mle YÃ¶nÃ¼ AyarÄ±
        if (level.dir === 'v') {
            targetZone.className = 'zone-vertical';
        } else {
            targetZone.className = 'zone-horizontal';
        }

        sentStart.innerText = level.start;
        sentEnd.innerText = level.end;
        levelDisplay.innerText = `Seviye ${currentLevelIdx + 1} / ${levels.length}`;

        spawnWords();
    }

    function spawnWords() {
        const level = levels[currentLevelIdx];
        
        let wordsToSpawn = [
            { text: level.correct, type: 'controlled', isCorrect: true },
            { text: level.wrongs[0], type: 'decoy', isCorrect: false },
            { text: level.wrongs[1], type: 'decoy', isCorrect: false }
        ];
        if(level.wrongs[2]) wordsToSpawn.push({ text: level.wrongs[2], type: 'decoy', isCorrect: false });

        // BÃ¶lmeli YerleÅŸtirme (Overlap Ã¶nleme)
        const slots = [10, 35, 60, 85];
        slots.sort(() => Math.random() - 0.5);

        wordsToSpawn.forEach((w, i) => {
            const el = document.createElement('div');
            el.className = `falling-word`; 
            el.innerText = w.text;
            
            let currentSpeed = 0.05 * baseSpeedFactor;
            
            const obj = {
                el: el,
                x: slots[i % slots.length],
                y: -15 - (Math.random() * 30), 
                speed: currentSpeed + (Math.random() * 0.05),
                isVertical: false,
                isControlled: w.type === 'controlled',
                text: w.text
            };

            if (obj.isControlled) {
                controlledWordIndex = activeWords.length;
                obj.speed += 0.02; // Ã‡ok hafif hÄ±z avantajÄ±
            }

            wordsContainer.appendChild(el);
            activeWords.push(obj);
            updateVisuals(obj);
        });
    }

    function updateVisuals(wordObj) {
        wordObj.el.style.left = wordObj.x + '%';
        wordObj.el.style.top = wordObj.y + '%';
        
        if (wordObj.isVertical) {
            wordObj.el.classList.add('rotated-vertical');
        } else {
            wordObj.el.classList.remove('rotated-vertical');
        }
    }

    function gameLoop() {
        if (!isPlaying) return;

        let controlledStillAlive = false;

        activeWords.forEach((word) => {
            word.y += word.speed;
            
            // Ekran dÄ±ÅŸÄ±na Ã§Ä±kma kontrolÃ¼
            if (word.y > 105) {
                if (word.isControlled) {
                    playSound('fail');
                    resetLevel();
                    return;
                }
            } else {
                updateVisuals(word);
                if (word.isControlled) {
                    controlledStillAlive = true;
                    checkCollision(word);
                }
            }
        });

        if (controlledStillAlive) {
            animationId = requestAnimationFrame(gameLoop);
        }
    }

    function checkCollision(wordObj) {
        const rectWord = wordObj.el.getBoundingClientRect();
        const rectGap = gapEl.getBoundingClientRect();
        const level = levels[currentLevelIdx];

        // Koordinat Ã§arpÄ±ÅŸma kontrolÃ¼
        const overlapX = rectWord.left < rectGap.right && rectWord.right > rectGap.left;
        const overlapY = rectWord.top < rectGap.bottom && rectWord.bottom > rectGap.top;

        if (overlapX && overlapY) {
            // YÃ¶n kontrolÃ¼ (Yatay kelime yatay boÅŸluÄŸa, dikey dikeye)
            const orientationMatch = (level.dir === 'v' && wordObj.isVertical) || (level.dir === 'h' && !wordObj.isVertical);

            if (orientationMatch) {
                winLevel(wordObj);
            } else {
                // YanlÄ±ÅŸ yÃ¶n uyarÄ±sÄ±
                wordObj.el.style.backgroundColor = "#ef4444";
                wordObj.el.style.borderColor = "#b91c1c";
            }
        } else {
            // Normale dÃ¶n
            wordObj.el.style.backgroundColor = "#6366f1";
            wordObj.el.style.borderColor = "#818cf8";
        }
    }

    function winLevel(wordObj) {
        isPlaying = false;
        playSound('win');
        
        gapEl.innerText = wordObj.text;
        gapEl.className = "drop-zone correct-anim";
        gapEl.style.backgroundColor = "#22c55e";
        gapEl.style.color = "white";

        wordObj.el.classList.add('hidden');

        const level = levels[currentLevelIdx];
        const dirIcon = level.dir === 'v' ? 'â¬‡ï¸' : 'âž¡ï¸';
        completedSentences.push(`${dirIcon} ${level.start} ${level.correct} ${level.end}`);

        setTimeout(() => {
            currentLevelIdx++;
            if (currentLevelIdx >= levels.length) {
                showWinScreen();
            } else {
                loadLevel();
                isPlaying = true;
                gameLoop();
            }
        }, 1500);
    }

    function resetLevel() {
        isPlaying = false;
        setTimeout(() => {
            loadLevel();
            isPlaying = true;
            gameLoop();
        }, 500);
    }

    // --- KONTROL SÄ°STEMÄ° ---
    
    function move(dx, dy) {
        if (!isPlaying || controlledWordIndex === -1) return;
        const word = activeWords[controlledWordIndex];
        
        const moveSpeed = 4 + (baseSpeedFactor * 0.5);

        if (dx !== 0) {
            word.x += (dx > 0 ? moveSpeed/4 : -moveSpeed/4); 
            // Mobil ekran sÄ±nÄ±rlarÄ±
            if (word.x < 2) word.x = 2;
            if (word.x > 85) word.x = 85; // Dikey modda taÅŸmayÄ± Ã¶nle
        }
        if (dy !== 0) {
            word.y += dy; 
        }
        updateVisuals(word);
    }

    function rotateWord() {
        if (!isPlaying || controlledWordIndex === -1) return;
        const word = activeWords[controlledWordIndex];
        word.isVertical = !word.isVertical;
        playSound('rotate');
        updateVisuals(word);
    }

    // Klavye DesteÄŸi
    document.addEventListener('keydown', (e) => {
        if (!isPlaying) return;
        if (e.key === 'ArrowLeft') move(-1, 0);
        if (e.key === 'ArrowRight') move(1, 0);
        if (e.key === 'ArrowDown') move(0, 3);
        if (e.key === ' ' || e.key === 'ArrowUp') rotateWord();
    });

    // Mobil Buton BaÄŸlantÄ±larÄ±
    const setupBtn = (id, action) => {
        const btn = document.getElementById(id);
        let interval;
        
        // Touch events
        btn.addEventListener('touchstart', (e) => { 
            e.preventDefault(); // Zoom engelle
            action(); 
            interval = setInterval(action, 100);
        }, {passive:false});
        
        btn.addEventListener('touchend', (e) => {
            e.preventDefault();
            clearInterval(interval);
        });
        
        // Mouse events (PC iÃ§in)
        btn.addEventListener('mousedown', (e) => { 
            action(); 
            interval = setInterval(action, 100);
        });
        btn.addEventListener('mouseup', () => clearInterval(interval));
        btn.addEventListener('mouseleave', () => clearInterval(interval));
    };

    const setupSingleBtn = (id, action) => {
        const btn = document.getElementById(id);
        btn.addEventListener('touchstart', (e) => { e.preventDefault(); action(); }, {passive:false});
        btn.addEventListener('mousedown', (e) => { e.preventDefault(); action(); });
    }

    setupBtn('btn-left', () => move(-1, 0));
    setupBtn('btn-right', () => move(1, 0));
    setupSingleBtn('btn-down', () => move(0, 5));
    setupSingleBtn('btn-rotate', () => rotateWord());

    // --- OYUN YÃ–NETÄ°MÄ° ---

    function startGame() {
        overlay.classList.add('hidden');
        document.getElementById('completed-list-container').classList.add('hidden');
        currentLevelIdx = 0;
        completedSentences = [];
        isPlaying = true;
        baseSpeedFactor = parseInt(speedSlider.value);
        loadLevel();
        gameLoop();
    }

    function showWinScreen() {
        document.getElementById('overlay-title').innerText = "Tebrikler Bilal!";
        document.getElementById('overlay-desc').innerText = "TÃ¼m cÃ¼mleleri baÅŸarÄ±yla tamamladÄ±n!";
        document.querySelector('#overlay button').innerText = "TEKRAR OYNA";
        
        const listContainer = document.getElementById('completed-list-container');
        const ul = document.getElementById('sentences-ul');
        ul.innerHTML = '';
        completedSentences.forEach(s => {
            const li = document.createElement('li');
            li.innerText = s;
            li.className = "bg-slate-700 p-2 rounded border border-slate-600";
            ul.appendChild(li);
        });
        
        listContainer.classList.remove('hidden');
        overlay.classList.remove('hidden');
    }

    // Ä°lk aÃ§Ä±lÄ±ÅŸ
    document.getElementById('overlay').classList.remove('hidden');

</script>
</body>
</html>

